!function($){$.rcrop={settings:{full:!1,minSize:[20,20],maxSize:[null,null],preserveAspectRatio:!1,inputs:!0,inputsPrefix:"",grid:!1,preview:{display:!1,size:[50,50],wrapper:""}}},ResponsiveCrop=function(el,options){var self=this,prefix="rcrop-",initValues={x:0,y:0,width:0,height:0};this.el=el instanceof $?el:$(el),this.image={instance:null,width:0,height:0},this.wrapper=$("<div>",{class:"rcrop-wrapper"}),this.cropArea=$("<div>",{class:"rcrop-croparea"}),this.cropData={width:0,height:0,x:0,y:0},this.outer={wrapper:$("<div>",{class:"rcrop-outer-wrapper"}),left:$("<div>",{class:"rcrop-outer rcrop-outer-left"}),right:$("<div>",{class:"rcrop-outer rcrop-outer-right"}),top:$("<div>",{class:"rcrop-outer rcrop-outer-top"}),bottom:$("<div>",{class:"rcrop-outer rcrop-outer-bottom"})},this.cropAspectRatio,this.preview=null,this.clayfy,this.settings=$.extend(!0,{},$.rcrop.settings,options);var init=function(){self.cropAspectRatio=self.settings.minSize[0]/self.settings.minSize[1],setContext(),self.settings.preview.display&&setPreview(),self.getRealSize((function(){setCropArea(),self.el.trigger("rcrop-ready")}))},setContext=function(){if(self.wrapper.insertAfter(self.el),self.wrapper.append(self.el),self.wrapper.append(self.outer.wrapper),self.outer.wrapper.append(self.outer.left,self.outer.right,self.outer.top,self.outer.bottom),self.wrapper.append(self.cropArea),self.cropArea.append('<div class="rcrop-croparea-inner">'),self.settings.grid){var grid='<div class="rcrop-grid-line"></div>';self.cropArea.append('<div class="rcrop-grid">'+grid+grid+"</div>")}if(addHandlers(),self.settings.inputs){var indexPrefix=0!=self.settings.inputsPrefix?self.settings.inputsPrefix+"-":"",inputs=["x","y","width","height"];$.each(inputs,(function(i,coord){self.wrapper.append('<input type="hidden" name="'+indexPrefix+coord+'[]">')}))}},addHandlers=function(){var handlerWr=$('<div class="rcrop-handler-wrapper"></div>');isTouchDevice()?handlerWr.append('<div class="rcrop-handler-bottom-right rcrop-handler-corner"></div>'):($.each(["top-left","top-right","bottom-left","bottom-right"],(function(i,pos){handlerWr.append('<div class="rcrop-handler-'+pos+" "+prefix+'handler-corner"></div>')})),$.each(["top","right","bottom","left"],(function(i,pos){handlerWr.append('<div class="rcrop-handler-'+pos+" "+prefix+'handler-border"></div>')}))),self.cropArea.append(handlerWr)},changeStart=function(){var pos=self.cropArea.position();initValues={width:Math.round(self.cropArea.width()),height:Math.round(self.cropArea.height()),x:Math.round(pos.left),y:Math.round(pos.top)}},changeEnd=function(){var pos=self.cropArea.position(),width=initValues.width!==Math.round(self.cropArea.width()),height=initValues.height!==Math.round(self.cropArea.height()),x=initValues.x!==Math.round(pos.left),y=initValues.y!==Math.round(pos.top);updateCropData(width,height,x,y)},updateCropData=function(width,height,x,y){if(!1!==width&&(self.cropData.width="number"==typeof width?width:toAbsoluteValue(self.clayfy.newSize.width),self.cropData.width=Math.max(self.cropData.width,self.settings.minSize[0]),self.settings.maxSize[0]&&(self.cropData.width=Math.min(self.cropData.width,self.settings.maxSize[0]))),!1!==height&&(self.cropData.height="number"==typeof height?height:toAbsoluteValue(self.clayfy.newSize.height),self.cropData.height=Math.max(self.cropData.height,self.settings.minSize[1]),self.settings.maxSize[1]&&(self.cropData.height=Math.min(self.cropData.height,self.settings.maxSize[1]))),(!1!==height||!1!==width)&&self.settings.preserveAspectRatio){var limitW={max:self.settings.maxSize[0]||self.image.width,min:self.settings.minSize[0]};self.cropData.height*self.cropAspectRatio>limitW.max||self.cropData.height*self.cropAspectRatio<limitW.min?self.cropData.height=Math.round(self.cropData.width/self.cropAspectRatio):self.cropData.width=Math.round(self.cropData.height*self.cropAspectRatio)}!1!==x&&(self.cropData.x="number"==typeof x?x:toAbsoluteValue(self.clayfy.newSize.left),self.cropData.x+self.cropData.width>self.image.width&&(self.cropData.x=self.image.width-self.cropData.width)),!1!==y&&(self.cropData.y="number"==typeof y?y:toAbsoluteValue(self.clayfy.newSize.top),self.cropData.y+self.cropData.height>self.image.height&&(self.cropData.y=self.image.height-self.cropData.height)),self.settings.inputs&&$.each(["width","height","x","y"],(function(i,coord){self.wrapper.find('[name$="'+coord+'[]"]').val(self.cropData[coord])})),self.settings.preview.display&&updatePreview()},toPercentage=function(){var realSize=self.el[0].getBoundingClientRect(),iW=realSize.width,iH=realSize.height,clayfySize=self.clayfy.newSize,size_width=clayfySize.width,size_height=clayfySize.height,size_top=clayfySize.top,size_left=clayfySize.left;self.cropArea.css({width:size_width/iW*100+"%",height:size_height/iH*100+"%",top:size_top/iH*100+"%",left:size_left/iW*100+"%"}),self.outer.left.width(size_left/iW*100+"%"),self.outer.top.height(size_top/iH*100+"%"),self.outer.bottom.css({top:(size_top+size_height)/iH*100+"%"}),self.outer.right.css({left:(size_left+size_width)/iW*100+"%"})},resizeOuters=function(){var size=self.clayfy.newSize;self.outer.left.width(size.left),self.outer.top.height(size.top),self.outer.bottom.css({top:size.top+size.outerHeight}),self.outer.right.css({left:size.left+size.outerWidth})},updateClayfySettings=function(){var s=self.settings,cS=self.clayfy.settings;cS.minSize=toRelativeValue(s.minSize),cS.maxSize=toRelativeValue(s.maxSize),self.clayfy.draggable.setBounderies()},setCropArea=function(){var s=self.settings;self.cropArea.clayfy({type:"resizable",container:self.wrapper,preserveAspectRatio:s.preserveAspectRatio,minSize:toRelativeValue(s.minSize),maxSize:toRelativeValue(s.maxSize)}),self.clayfy=self.cropArea.clayfy("instance"),self.clayfy.originalSize.width=self.settings.minSize[0],self.clayfy.originalSize.height=self.settings.minSize[1];var height=s.full?self.image.height:Math.max(.8*self.image.height,s.minSize[1]),width=s.full?self.image.width:Math.max(.8*self.image.width,s.minSize[0]);self.resize(width,height,"center","center"),self.cropArea.on("mousedown touchstart",updateClayfySettings),self.cropArea.on("clayfy-resizestart clayfy-dragstart",changeStart),self.cropArea.on("clayfy-resizeend clayfy-drop",changeEnd),self.cropArea.on("clayfy-resize clayfy-drag",resizeOuters),self.settings.preview.display&&(self.cropArea.on("clayfy-resize clayfy-drag",updatePreview),self.cropArea.on("clayfy-cancel",updatePreview)),self.cropArea.on("clayfy-resizeend clayfy-drop",toPercentage),self.cropArea.on("clayfy-cancel",toPercentage),self.cropArea.on("clayfy-resizeend clayfy-drop",(function(){self.el.trigger("rcrop-changed",[self])})),self.cropArea.on("clayfy-drag clayfy-resize",(function(){self.el.trigger("rcrop-change",[self])}))},getPreviewSize=function(){var previewSize=self.settings.preview.size,size=[],cropAreaSize=self.clayfy?self.clayfy.newSize:{width:self.cropArea.width(),height:self.cropArea.height()};return"string"==typeof previewSize[0]&&previewSize[0].indexOf("%")>-1?size[0]=Number(previewSize[0].replace("%",""))/100*cropAreaSize.width:size[0]=previewSize[0],"string"==typeof previewSize[1]&&previewSize[1].indexOf("%")>-1?size[1]=Number(previewSize[1].replace("%",""))/100*cropAreaSize.height:size[1]=previewSize[1],size},setPreview=function(){var wrPrev=self.settings.preview.wrapper;wrPrev&&(wrPrev=wrPrev instanceof $?wrPrev:$(wrPrev)),wrPrev&&wrPrev.length||(wrPrev=$("<div>",{class:"rcrop-preview-wrapper"}),self.wrapper.after(wrPrev));var size=getPreviewSize();self.preview=$('<canvas width="'+size[0]+'" height="'+size[1]+'"></canvas>'),self.preview.appendTo(wrPrev)},updatePreview=function(e){var data=self.cropData;e&&(data=toAbsoluteValue({width:self.clayfy.newSize.width,height:self.clayfy.newSize.height,x:self.clayfy.newSize.left,y:self.clayfy.newSize.top}));var newSize=getPreviewSize(),ctx;self.preview.attr({width:newSize[0],height:newSize[1]}),self.preview[0].getContext("2d").drawImage(self.image.instance,data.x,data.y,data.width,data.height,0,0,newSize[0],newSize[1])},translateValue=function(value,coef){if("object"==typeof value){var newValue=value instanceof Array?[]:{};for(var i in value)newValue[i]="number"!=typeof value[i]?null:Math.round(value[i]*coef);return newValue}return Math.round(value*coef)},toRelativeValue=function(value){return translateValue(value,self.el.width()/self.image.width)},toAbsoluteValue=function(value){return translateValue(value,self.image.width/self.el.width())};this.getValues=function(){return{width:self.cropData.width,height:self.cropData.height,y:self.cropData.y,x:self.cropData.x}},this.getRealSize=function(callback){var img=new Image;img.setAttribute("crossOrigin","anonymous"),img.onload=function(){return self.image.width=this.width,self.image.height=this.height,"function"==typeof callback&&callback(),{width:self.image.width,height:self.image.height}},img.onerror=function(){return{width:null,height:null}},img.src=self.el.attr("src"),self.image.instance=img},this.getDataURL=function(width,height){width=width||self.cropData.width,height=height||self.cropData.height;var canvas=$('<canvas width="'+width+'" height="'+height+'"></canvas>'),ctx;return canvas[0].getContext("2d").drawImage(self.image.instance,self.cropData.x,self.cropData.y,self.cropData.width,self.cropData.height,0,0,width,height),canvas[0].toDataURL()},this.resize=function(width,height,x,y){var s=self.settings,relativeWidth,relativeHeight,relativeX,relativeY;width=s.maxSize[0]?Math.min(width,self.image.width,s.maxSize[0]):Math.min(width,self.image.width),height=s.maxSize[1]?Math.min(height,self.image.height,s.maxSize[1]):Math.min(height,self.image.height),width=s.minSize[0]?Math.max(width,s.minSize[0]):width,height=s.minSize[1]?Math.max(height,s.minSize[1]):height,s.preserveAspectRatio&&(width/height>self.cropAspectRatio?width=height*self.cropAspectRatio:height=width/self.cropAspectRatio),width=Math.round(width),height=Math.round(height),relativeWidth=toRelativeValue(width),relativeHeight=toRelativeValue(height),(y=void 0===y?self.cropArea.position().top:"center"===y?Math.round((self.image.height-height)/2):Math.round(y))+height>self.image.height&&(y=self.image.height-height),relativeY=toRelativeValue(y),(x=void 0===x?self.cropData.x?toAbsoluteValue(self.cropArea.position().left):self.cropData.x:"center"===x?Math.round((self.image.width-width)/2):Math.round(x))+width>self.image.width&&(x=self.image.width-width),relativeX=toRelativeValue(x),self.cropArea.css({width:relativeWidth,height:relativeHeight,top:relativeY,left:relativeX}),self.clayfy.newSize=self.clayfy.getNewSize(),updateCropData(width,height,x,y),resizeOuters(),toPercentage(),self.settings.preview.display&&updatePreview()},this.destroy=function(){var image=self.el;self.wrapper.replaceWith(image),image.attr("style","")},init()};var pluginName="rcrop",Plugin=ResponsiveCrop;$.fn.rcrop=function(options){var args=arguments;if(void 0===options||"object"==typeof options)return this.each((function(){$.data(this,"rcrop")||$.data(this,"rcrop",new Plugin(this,options))}));if("string"==typeof options&&"_"!==options[0]&&"init"!==options){if("instance"===options)return this.length?$.data(this[0],"rcrop"):null;if(-1!=$.inArray(options,$.fn.rcrop.getters)){var instance=$.data(this[0],"rcrop");return instance[options].apply(instance,Array.prototype.slice.call(args,1))}return this.each((function(){var instance=$.data(this,"rcrop");instance instanceof Plugin&&"function"==typeof instance[options]&&instance[options].apply(instance,Array.prototype.slice.call(args,1)),"destroy"===options&&$(this).removeData("rcrop")}))}},$.fn.rcrop.getters=["getDataURL","getValues","getRealSize"]}(jQuery),function(){function Clayfy(el,options){this.instance;var self=this,options;switch((options=$.extend(!0,{},$.clayfy.settings,options)).type){case"draggable":this.instance=new Draggable(el,options);break;case"resizable":this.instance=new Resizable(el,options);break;case"sortable":this.instance=new Sortable(el,options)}}function Draggable(el,options){this.el=el instanceof $?el:$(el),this.draggableBox,this.x,this.y,this.dX,this.dY,this.diffDX,this.diffDY,this.history={dX:[0,0,0],dY:[0,0,0],diffDX:0,diffDY:0},this.actualPos,this.originalPos,this.initPos={y:0,x:0,scrollTop:null,scrollLeft:null},this.bounderies={},this.droppedTarget,this.scrollable=[],this.container={},this.tempContainer=$("<div>",{style:"position: absolute; top:0; left:0"}),this.droppable={dragElement:[],dropArea:[]},this.status="ready",this.settings=$.extend(!0,{},$.clayfy.settings,options);var self=this,move=!1,first=!0,cursor,notDraggable,screenCoverLayer=$("<div>",{style:"height:100%;width:100%;position:fixed;top:0;left:0"}),init=function(){self.originalPos=self.getPosition(),self.actualPos=self.originalPos,setContainer(),setDraggableBox(),self.el.addClass("clayfy-box"),self.settings.move||self.el.addClass("clayfy-not-move"),cursor=self.el.css("cursor"),notDraggable=$(self.settings.not),self.settings.overflow&&$("body").append(self.tempContainer),self.el.on("mousedown touchstart",mousedown),$("body").on("mouseup touchend",mouseup),self.settings.escape&&(self.el.on("clayfy-dragstart",(function(e){e.stopPropagation(),$(window).on("keydown",keydownObserver)})),self.el.on("clayfy-drop",(function(){$(window).off("keydown",keydownObserver)}))),!1!==self.settings.scrollable&&"node"===self.container.type&&(self.settings.container instanceof DraggableContainer||("string"==typeof self.settings.scrollable?self.settings.scrollable=self.settings.scrollable?self.settings.scrollable+" , "+self.settings.container:self.settings.container:self.settings.scrollable instanceof $&&(self.settings.scrollable=self.settings.scrollable.add(self.settings.container)))),self.el.on("clayfy-dragstart",setScrollable),self.el.on("clayfy-drag",scrollableObserver),self.el.on("clayfy-drop",stopScroll),0!=self.settings.droppable?(self.updateDragElement(),self.updateDropArea(),bindDropEvents()):self.settings.ghost&&self.el.on("clayfy-drop",dropGhost)};this.contentGhost;var setDraggableBox=function(){self.settings.ghost?(!0===self.settings.ghost?(self.draggableBox=self.el.clone(),self.draggableBox.addClass("clayfy-ghost-opacity")):(self.draggableBox=$("<div>",{margin:self.el.css("margin")}),self.contentGhost=$('<div class="clayfy-ghost-content" style="position:absolute"></div>'),self.draggableBox.append(self.contentGhost)),self.draggableBox.css({position:"absolute",width:"100%",height:"100%"}).addClass("clayfy-ghost")):self.draggableBox=self.el},updateGhost=function(e){var pos=self.getPosition(self.el),c=self.settings.overflow?self.tempContainer:self.el.parent(),offset=self.el.offset(),scrTop=self.initPos.parent?self.initPos.parent.scrollTop():0,scrLeft=self.initPos.parent?self.initPos.parent.scrollLeft():0,css={width:self.el.width(),height:self.el.height(),top:pos.y,left:pos.x};if(!0!==self.settings.ghost&&(css={top:e.pageY-offset.top+pos.y+5-scrTop,left:e.pageX-offset.left+pos.x+5-scrLeft,width:"auto",height:"auto"}),self.settings.overflow&&(css.top=offset.top-scrTop,css.left=offset.left-scrLeft,!0!==self.settings.ghost&&(css.top=e.pageY-scrTop+5,css.left=e.pageX-scrLeft+5)),self.draggableBox.css(css),self.draggableBox.appendTo(c),self.contentGhost){var content;switch(self.contentGhost.html(""),typeof self.settings.ghost){case"string":content=self.settings.ghost;break;case"function":content=self.settings.ghost()}if(self.contentGhost.append(content),self.container.offset){var cBottom=self.container.offset.innerBottom,cRight=self.container.offset.innerRight,ghostOffset=self.draggableBox.offset(),bottomDiff=ghostOffset.top+self.contentGhost.outerHeight()-cBottom,RightDiff=ghostOffset.left+self.contentGhost.outerWidth()-cRight;bottomDiff>0&&self.draggableBox.css({top:e.pageY-offset.top+pos.y+5-bottomDiff}),RightDiff>0&&self.draggableBox.css({left:e.pageX-offset.left+pos.x+5-RightDiff})}}},dropGhost=function(e){if("canceling"!==self.status&&self.settings.move){var pos=self.getPosition(),offset=self.draggableBox.offset(),d=self.contentGhost?self.contentGhost:self.draggableBox;if(self.container.offset){var cBottom=self.container.offset.innerBottom,cRight=self.container.offset.innerRight;offset.top>=cBottom-self.el.outerHeight()&&(pos.y+=cBottom-self.el.outerHeight()-offset.top),offset.left>=cRight-self.el.outerWidth()&&(pos.x+=cRight-self.el.outerWidth()-offset.left)}if(self.el.css({top:pos.y,left:pos.x}),"clayfy-dropinside"===e.type){var cBottom=e.area.offset.innerBottom,cRight=e.area.offset.innerRight;offset.top>=cBottom-self.el.outerHeight()&&(pos.y+=cBottom-self.el.outerHeight()-offset.top),offset.left>=cRight-self.el.outerWidth()&&(pos.x+=cRight-self.el.outerWidth()-offset.left),self.el.css({top:pos.y,left:pos.x})}}self.draggableBox.detach()},setContainer=function(){var c=self.settings.container;c instanceof DraggableContainer?self.container=c:self.settings.container&&(self.container=new DraggableContainer(self.el,c))},keydownObserver=function(e){27===e.keyCode&&self.cancel(e)},scrDown,scrUp,scrLeft,scrRight;this.cancel=function(e){self.status="canceling",self.draggableBox.animate({top:self.initPos.y,left:self.initPos.x},100,(function(){self.draggableBox.trigger("mouseup"),self.status="ready"})),null!==self.initPos.scrollTop&&self.initPos.parent.animate({scrollTop:self.initPos.scrollTop},100),null!==self.initPos.scrollLeft&&self.initPos.parent.animate({scrollLeft:self.initPos.scrollLeft},100)},self.scrollables=[];var setScrollable=function(){var scrollable;$(self.settings.scrollable).each((function(){var $this=$(this);if(!$this.length)return!0;var overflow=isOverflowed($this);if(!overflow.x&&!overflow.y)return!0;var o=$this[0].getBoundingClientRect(),dimension=getDimension($this),borderTop=parseInt($this.css("border-top-width")),borderLeft=parseInt($this.css("border-left-width")),obj={el:$this,top:o.top+borderTop,bottom:o.top+dimension.innerHeight+borderTop,left:o.left+borderLeft,right:o.left+dimension.innerWidth+borderLeft,innerHeight:dimension.innerHeight,innerWidth:dimension.innerWidth,interval:{top:!1,bottom:!1,left:!1,right:!1},isParent:!self.settings.overflow&&self.el.offsetParent().is($this),isBody:$this.is("body")};if(obj.isBody){var $w=$(window);obj.top=0,obj.left=0,obj.bottom=$w.height(),obj.right=$w.width(),obj.innerHeight=$w.height(),obj.innerWidth=$w.width()}self.scrollables.push(obj)}))},isOverflowed=function(scrollable){var x=!1,y=!1,$w=$(window),$b=$("body");return scrollable.is("body")?($b.height()>$w.height()&&(y=!0),$b.width()>$w.width()&&(x=!0)):(scrollable[0].scrollHeight>scrollable.height()&&(y=!0),scrollable[0].scrollWidth>scrollable.width()&&(x=!0)),{x:x,y:y}},getDimension=function(element){var el=element instanceof $?element:$(element),stylePos,helper,helperWr,innerWidth,innerHeight,borderTop,borderLeft;return el.length?(stylePos=el[0].style.position,"static"===el.css("position")&&el.css({position:"relative"}),helperWr=$("<div>",{style:"position:absolute;top:0;left:0;bottom:0;right:0"}),helper=$("<div>",{style:"position:absolute;top:0;left:0;width:100%;height:100%"}),helperWr.append(helper),el.append(helperWr),innerWidth=helper.width(),innerHeight=helper.height(),borderTop=parseInt(helper.css("border-top-width")),borderLeft=parseInt(helper.css("border-left-width")),helperWr.remove(),el[0].style.position=stylePos,{innerWidth:innerWidth,innerHeight:innerHeight,innerOffset:{top:borderTop,left:borderLeft,bottom:innerHeight+borderTop,right:innerWidth+borderLeft}}):{width:0,height:0}};function isAtBottom(scrollable){return scrollable.el[0].scrollHeight-scrollable.el.scrollTop()===scrollable.innerHeight}function isAtRight(scrollable){return scrollable.el[0].scrollWidth-scrollable.el.scrollLeft()===scrollable.innerWidth}var scrollableObserver=function(e){var d=self.contentGhost?self.contentGhost:self.draggableBox,o=self.draggableBox[0].getBoundingClientRect(),dOffset=d.offset(),padding=6,el={top:o.top,bottom:o.top+d.outerHeight(),left:o.left,right:o.left+d.outerWidth(),x:0,y:0};el.x=(el.right-el.left)/2+el.left,el.y=(el.bottom-el.top)/2+el.top,self.history.diffDY>0&&scrDown&&(scrDown=!1,self.y=Math.min(dOffset.top+d.outerHeight(),e.pageY)),self.history.diffDY<0&&scrUp&&(scrUp=!1,self.y=Math.max(dOffset.top,e.pageY)),self.history.diffDX>0&&scrRight&&(scrRight=!1,self.x=Math.min(dOffset.left+d.outerWidth(),e.pageX)),self.history.diffDX<0&&scrLeft&&(scrLeft=!1,self.x=Math.max(dOffset.left,e.pageX));for(var i=0,j=self.scrollables.length;i<j;i++){var s=self.scrollables[i],trigger=0,val={top:el.top-s.top,bottom:s.bottom-el.bottom,left:el.left-s.left,right:s.right-el.right,x:el.x<s.right&&el.x>s.left,y:el.y<s.bottom&&el.y>s.top};if(!isAtBottom(s)&&val.bottom<6&&(val.bottom>-6||s.isBody)&&val.x?(startScroll(e,s,"bottom"),stopScroll(s,"top"),trigger++):(stopScroll(s,"bottom"),s.el.scrollTop()&&val.top<6&&(val.top>-6||s.isBody)&&val.x?(startScroll(e,s,"top"),trigger++):stopScroll(s,"top")),s.el.scrollLeft()&&val.left<6&&(val.left>-6||s.isBody)&&val.y?(startScroll(e,s,"left"),stopScroll(s,"right"),trigger++):(stopScroll(s,"left"),!isAtRight(s)&&val.right<6&&(val.right>-6||s.isBody)&&val.y?(startScroll(e,s,"right"),trigger++):stopScroll(s,"right")),trigger)break}},startScroll=function(e,scrollable,toward){scrollable.interval[toward]&&clearInterval(scrollable.interval[toward]);var scrollToward=function(amount){};switch(toward){case"bottom":scrollToward=function(amount){amount=amount||10,scrollable.el.scrollTop(scrollable.el.scrollTop()+amount),scrollable.isParent&&(self.x=e.pageX,self.setBounderies(),self.updateDropArea(),scrDown=!0)};break;case"top":scrollToward=function(amount){amount=amount||10,scrollable.el.scrollTop(scrollable.el.scrollTop()-amount),scrollable.isParent&&(self.x=e.pageX,self.setBounderies(),self.updateDropArea(),scrUp=!0)};break;case"left":scrollToward=function(amount){amount=amount||10,scrollable.el.scrollLeft(scrollable.el.scrollLeft()-amount),scrollable.isParent&&(self.y=e.pageY,self.setBounderies(),self.updateDropArea(),scrLeft=!0)};break;case"right":scrollToward=function(amount){amount=amount||10,scrollable.el.scrollLeft(scrollable.el.scrollLeft()+amount),scrollable.isParent&&(self.y=e.pageY,self.setBounderies(),self.updateDropArea(),scrRight=!0)}}scrollToward(3),scrollable.isParent||(scrollable.interval[toward]=setInterval(scrollToward,50))},stopScroll=function(scrollable,toward){if(toward)scrollable.interval[toward]&&(clearInterval(scrollable.interval[toward]),scrollable.interval[toward]=!1);else for(var i in self.scrollables){var interval=self.scrollables[i].interval;for(var pos in interval)interval[pos]&&(clearInterval(interval[pos]),interval[pos]=!1)}};this.appendTo=function(parent,el){if(el=el||self.el,(parent=parent instanceof $?parent:$(parent)).length){var oE=el.offset(),oP=parent.offset(),pos={top:oE.top-oP.top-parseInt(parent.css("border-top-width"))+parent.scrollTop(),left:oE.left-oP.left-parseInt(parent.css("border-left-width"))+parent.scrollLeft()};"static"===parent.css("position")&&parent.css("position","relative"),el.appendTo(parent).css(pos)}};var bindDropEvents=function(){self.el.on("clayfy-dragstart",self.updateDragElement),self.el.on("clayfy-dragstart",self.updateDropArea),self.el.on("clayfy-drag",dragover),self.el.on("clayfy-drop",dropOnBox),self.settings.ghost&&(self.el.on("clayfy-dropinside",dropGhost),self.el.on("clayfy-dropoutside",dropGhost)),self.el.on("clayfy-dragstart",(function(){var area;isOverDropArea()||(self.el.removeClass("clayfy-dropinside"),self.draggableBox.removeClass("clayfy-dropinside"))})),self.el.on("clayfy-dragenter",(function(e){self.el.addClass("clayfy-dragenter"),self.draggableBox.addClass("clayfy-dragenter"),e.droparea.addClass("clayfy-dragenter"),self.el[0].id&&e.droparea.addClass("clayfy-dragenter-"+self.el[0].id)})),self.el.on("clayfy-dragleave",(function(e){self.el.removeClass("clayfy-dropinside"),self.draggableBox.removeClass("clayfy-dropinside"),e.droparea.removeClass("clayfy-dropinside"),self.el[0].id&&e.droparea.removeClass("clayfy-dropinside-"+self.el[0].id)})),self.el.on("clayfy-dragleave clayfy-drop",(function(e){self.el.removeClass("clayfy-dragenter"),self.draggableBox.removeClass("clayfy-dragenter"),$(".clayfy-dragenter").removeClass("clayfy-dragenter"),self.el[0].id&&$(".clayfy-dragenter-"+self.el[0].id).removeClass("clayfy-dragenter-"+self.el[0].id)})),self.el.on("clayfy-dropinside",(function(e){self.el.addClass("clayfy-dropinside"),self.draggableBox.addClass("clayfy-dropinside"),e.droparea.addClass("clayfy-dropinside"),self.el[0].id&&e.droparea.addClass("clayfy-dropinside-"+self.el[0].id),self.settings.migrate&&self.appendTo(e.droparea)}))};this.updateDropArea=function(e){self.droppable.dropArea=[];var droppables=self.settings.droppable instanceof $?self.settings.droppable:$(self.settings.droppable);self.addDroppable(droppables)},this.updateDragElement=function(){self.droppable.dragElement=[],self.droppable.dragElement={originalPos:self.getPosition(),id:self.el[0].id,originalDropArea:null,width:self.draggableBox.width(),height:self.draggableBox.height(),x:0,y:0};var el=self.droppable.dragElement;el.setCenter=function(){var offset=self.draggableBox.offset();el.x=offset.left+el.width/2,el.y=offset.top+el.height/2},el.setCenter(),el.originalDropArea=isOverDropArea()},this.resetDroppable=function(elements){elements&&(self.settings.droppable=elements),self.updateDragElement(),self.updateDropArea()},this.addDroppable=function(elements){var droppables;(elements instanceof $?elements:$(elements)).each((function(){var $this=$(this),offset=$this.offset(),height=$this.outerHeight(),width=$this.outerWidth(),borderTop=parseInt($this.css("border-top-width")),borderLeft=parseInt($this.css("border-left-width")),inner=$.clayfy.getInner($this);self.droppable.dropArea.push({el:$this,id:this.id,left:offset.left,top:offset.top,width:width,height:height,innerWidth:inner.innerWidth,innerHeight:inner.innerHeight,offset:{innerTop:offset.top+borderTop,innerLeft:offset.left+borderLeft,innerBottom:inner.innerHeight+offset.top+borderTop,innerRight:inner.innerWidth+offset.left+borderLeft},right:offset.left+width,bottom:offset.top+height,active:!1,triggered:!1})}))};var dragover=function(e){var el=self.droppable.dragElement;el.setCenter();for(var i=0,j=self.droppable.dropArea.length;i<j;i++){var area=self.droppable.dropArea[i];area&&(el.x>area.left&&el.x<area.right&&el.y>area.top&&el.y<area.bottom?area.active=!0:area.active=!1,!area.triggered&&area.active?(area.triggered=!0,self.el.trigger($.Event("clayfy-dragenter",{target:area.el[0],droparea:area.el}))):area.triggered&&!area.active&&(area.triggered=!1,self.el.trigger($.Event("clayfy-dragleave",{target:area.el[0],droparea:area.el,area:area}))))}},isOverDropArea=function(){var el=self.droppable.dragElement;el.setCenter();for(var dropArea=!1,i=0,j=self.droppable.dropArea.length;i<j;i++){var area=self.droppable.dropArea[i];area&&(el.x>area.left&&el.x<area.right&&el.y>area.top&&el.y<area.bottom&&(area.active=!0,area.triggered=!0,dropArea=area))}return dropArea},fitInside=function(dropArea){var d=self.contentGhost?self.contentGhost:self.draggableBox,css={},offset=self.el.offset(),el_top=offset.top,el_left=offset.left,el_right=self.droppable.dragElement.width+offset.left,el_bottom=self.droppable.dragElement.height+offset.top;d.outerWidth()<dropArea.innerWidth&&(el_right>dropArea.offset.innerRight&&(css.left=parseInt(d.css("left"))+dropArea.offset.innerRight-el_right),el_left<dropArea.offset.innerLeft&&(css.left=parseInt(d.css("left"))+dropArea.offset.innerLeft-el_left)),d.outerHeight()<dropArea.innerHeight&&(el_bottom>dropArea.offset.innerBottom&&(css.top=parseInt(d.css("top"))+dropArea.offset.innerBottom-el_bottom),el_top<dropArea.offset.innerTop&&(css.top=parseInt(self.el.css("top"))+dropArea.offset.innerTop-el_top)),self.el.css(css)},forceDropInside=function(){var oda=self.droppable.dragElement.originalDropArea;oda&&self.el.trigger($.Event("clayfy-dropinside",{target:oda.el[0],droparea:oda.el})),self.settings.overflow&&!self.settings.ghost?self.el.css({left:self.initPos.x-self.initPos.parent.offset().left-parseInt(self.initPos.parent.css("border-left-width"))+self.initPos.scrollLeft,top:self.initPos.y-self.initPos.parent.offset().top-parseInt(self.initPos.parent.css("border-top-width"))+self.initPos.scrollTop}):self.el.css({left:self.initPos.x,top:self.initPos.y})},dropOnBox=function(){for(var area,i=0,j=self.droppable.dropArea.length;i<j;i++)self.droppable.dropArea[i].active&&(area=self.droppable.dropArea[i]);if("canceling"===self.status){if(area&&(area.active=!1,area.triggered=!1,self.el.trigger($.Event("clayfy-dragleave",{target:area.el[0],droparea:area.el}))),!(area=self.droppable.dragElement.originalDropArea))return;area.active=!0,area.triggered=!0}area?(self.el.trigger($.Event("clayfy-dropinside",{target:area.el[0],droparea:area.el,area:area})),self.settings.fit&&fitInside(area)):(self.el.trigger("clayfy-dropoutside"),self.settings.dropoutside||forceDropInside(),self.settings.dropoutside&&self.settings.migrate&&self.settings.overflow&&self.appendTo(self.tempContainer)),area&&(self.droppedTarget=area.el[0])},isOverContent=function(e){var x=e.pageX-self.el.offset().left,y=e.pageY-self.el.offset().top,helper=$("<div>",{style:"position:absolute;left:0;top:0;width:100%;height:100%"});self.el.append(helper);var hW=helper.width(),hH=helper.height();return helper.remove(),!(x>hW)&&!(y>hH)},mousedown=function(e){notDraggable.is(e.target)||self.el.has(e.target).length&&!self.settings.propagate||(isTouchDevice()||void 0===e.which||1===e.which)&&(e.preventDefault(),isOverContent(e)&&(self.settings.coverScreen&&coverScreen(),move=!0,document.body.style.cursor=cursor,self.settings.dragstart.call(self,e),self.el.trigger("clayfy-dragstart"),$(document).on("mousemove touchmove",mousemove).on("mouseup touchend",mouseup)))},mouseup=function(e){if(move){e.preventDefault(),move=!1,first=!0,document.body.style.cursor="",self.settings.overflow&&(self.appendTo(self.initPos.parent,self.draggableBox),self.appendTo(self.initPos.parent)),self.settings.coverScreen&&uncoverScreen(),self.settings.drop.call(self);var event=$.Event("clayfy-drop",{pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY});self.el.trigger(event),$(document).off("mousemove touchmove",mousemove).off("mouseup touchend",mouseup)}},mousemove=function(e){if(move){if(e.preventDefault(),e.originalEvent.touches&&1==e.originalEvent.touches.length)var e=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];if(first){first=!1;var p=self.el.parent();self.initPos.parent=p,self.settings.overflow&&self.appendTo(self.tempContainer,self.draggableBox),self.settings.ghost&&updateGhost(e),self.x=e.pageX,self.y=e.pageY,self.setBounderies();var pos=self.getPosition(self.el);self.initPos={x:pos.x,y:pos.y,scrollLeft:p.scrollLeft(),scrollTop:p.scrollTop(),parent:p},self.history={dX:[0,0,0],dY:[0,0,0],diffDX:0,diffDY:0}}self.dX=e.pageX-self.x,self.dY=e.pageY-self.y,$.clayfy.dX=self.dX,$.clayfy.dY=self.dY,self.history.diffDX=(self.history.dX[0]+self.history.dX[1]-(self.history.dX[2]+self.dX))/2,self.history.diffDY=(self.history.dY[0]+self.history.dY[1]-(self.history.dY[2]+self.dY))/2,self.history.dX=[self.history.dX[1],self.history.dX[2],self.dX],self.history.dY=[self.history.dY[1],self.history.dY[2],self.dY],self.fixDeltasWithBounderies(),(self.settings.move||self.settings.ghost)&&self.move(),self.settings.drag.call(self,e);var event=$.Event("clayfy-drag",{shiftKey:e.shiftKey,pageX:e.pageX,pageY:e.pageY,clientX:e.clientX,clientY:e.clientY,screenX:e.screenX,screenY:e.screenY,altKey:e.altKey});self.el.trigger(event)}},coverScreen=function(){$("body").append(screenCoverLayer)},uncoverScreen=function(){screenCoverLayer.detach()};this.getContainerBounderies=function(){if(!self.container.type)return!1;var elOffset=self.draggableBox.offset(),bounderies={},dWidth,dHeight;return self.container.update(),dWidth=self.contentGhost?self.contentGhost.outerWidth():self.draggableBox.outerWidth(),dHeight=self.contentGhost?self.contentGhost.outerHeight():self.draggableBox.outerHeight(),bounderies={top:elOffset.top-self.container.offset.innerTop,right:self.container.offset.innerRight-elOffset.left-dWidth,bottom:self.container.offset.innerBottom-elOffset.top-dHeight,left:elOffset.left-self.container.offset.innerLeft},isNaN(bounderies.top)&&(bounderies={top:1e13,right:1e13,bottom:1e13,left:1e13}),bounderies},this.setBounderies=function(){var b=self.settings.bounderies;self.actualPos=self.getPosition(),self.bounderies={top:-b[0],right:b[1],bottom:b[2],left:-b[3]};var cBounderies=self.getContainerBounderies();cBounderies&&(self.bounderies={top:Math.max(-cBounderies.top,self.bounderies.top),right:Math.min(cBounderies.right,self.bounderies.right),bottom:Math.min(cBounderies.bottom,self.bounderies.bottom),left:Math.max(-cBounderies.left,self.bounderies.left)})},this.move=function(){self.draggableBox.css({top:self.actualPos.y+$.clayfy.dY,left:self.actualPos.x+$.clayfy.dX})},this.getPosition=function(el){var parent=self.el.offsetParent(),draggableBox,pos=(draggableBox=void 0===el?self.draggableBox||self.el:el).position();return{y:pos.top+parent.scrollTop(),x:pos.left+parent.scrollLeft()}},this.fixDeltasWithBounderies=function(){$.clayfy.dX>self.bounderies.right&&($.clayfy.dX=self.bounderies.right),$.clayfy.dX<self.bounderies.left&&($.clayfy.dX=self.bounderies.left),$.clayfy.dY<self.bounderies.top&&($.clayfy.dY=self.bounderies.top),$.clayfy.dY>self.bounderies.bottom&&($.clayfy.dY=self.bounderies.bottom),self.settings.moveX||($.clayfy.dX=0),self.settings.moveY||($.clayfy.dY=0)},this.destroy=function(){},init()}function DraggableContainer(draggable,values){this.draggableEl=draggable instanceof $?draggable:$(draggable),this.values,this.el,this.type,this.originalDraggable,this.width=0,this.height=0,this.innerHeight=0,this.innerWidth=0,this.offset={top:0,left:0,innerBottom:0,innerRight:0,innerLeft:0,innerTop:0};var self=this,init=function(){"string"==typeof values||values instanceof $?(self.el=values instanceof $?values:$(values),self.type="node","static"===self.el.css("position")&&self.el.css("position","relative"),self.update=updateNode):(self.values=values,self.type="object",self.update=updateObject,self.originalDraggable=self.getDraggableValues()),self.update()},updateNode=function(){var inner=getInner(self.el);self.width=self.el.width(),self.height=self.el.height(),self.innerWidth=inner.innerWidth,self.innerHeight=inner.innerHeight,self.offset=self.el.offset(),self.offset.innerTop=self.offset.top+parseInt(self.el.css("border-top-width")),self.offset.innerLeft=self.offset.left+parseInt(self.el.css("border-left-width")),self.offset.innerBottom=self.offset.innerTop+self.innerHeight,self.offset.innerRight=self.offset.innerLeft+self.innerWidth},updateObject=function(){var actualEl=self.getDraggableValues();self.offset={top:actualEl.offset.top-(actualEl.position.top-self.originalDraggable.position.top)-self.values[0],left:actualEl.offset.left-(actualEl.position.left-self.originalDraggable.position.left)-self.values[3]},self.width=self.originalDraggable.outerWidth+self.values[3]+self.values[1],self.height=self.originalDraggable.outerHeight+self.values[0]+self.values[2],self.innerWidth=self.width,self.innerHeight=self.height,self.offset.innerTop=self.offset.top,self.offset.innerLeft=self.offset.left,self.offset.innerBottom=self.offset.top+self.height,self.offset.innerRight=self.offset.left+self.width},getInner=function(element){var el=element instanceof $?element:$(element),stylePos,helper,helperWr,innerWidth,innerHeight,borderTop,borderLeft;return el.length?(stylePos=el[0].style.position,"static"===el.css("position")&&el.css({position:"relative"}),helperWr=$("<div>",{style:"position:absolute;top:0;left:0;bottom:0;right:0"}),helper=$("<div>",{style:"position:absolute;top:0;left:0;width:100%;height:100%"}),helperWr.append(helper),el.append(helperWr),innerWidth=helper.width(),innerHeight=helper.height(),helperWr.remove(),el[0].style.position=stylePos,{innerWidth:innerWidth,innerHeight:innerHeight}):{width:0,height:0}};this.getDraggableValues=function(){var offset=self.draggableEl.offset(),parent=self.draggableEl.offsetParent();return{position:{top:self.draggableEl.position().top+parent.scrollTop(),left:self.draggableEl.position().left+parent.scrollLeft()},offset:offset,outerWidth:self.draggableEl.outerWidth(),outerHeight:self.draggableEl.outerHeight()}},init()}function Resizable(el,options){this.el=el instanceof $?el:$(el),this.originalSize={},this.initSize={},this.handlers=[],this.actualSize,this.newSize,this.draggable,this.preserveAspectRatio=!1,this.shift=!1,this.status="ready",this.touchableDevice;var defaults=$.extend(!0,{},$.clayfy.settings,{callbacks:{resizestart:function(){},resize:function(){},resizeend:function(){}}});this.settings=$.extend(!0,{},defaults,options);var self=this,timeout,insideBox=!1,init=function(){self.touchableDevice=isTouchDevice(),self.originalSize=self.getSize(),self.actualSize=self.originalSize,self.newSize=self.getNewSize(),createNodes(),self.preserveAspectRatio=self.settings.preserveAspectRatio,self.el.on("clayfy-resizestart",(function(e){self.initSize=self.getNewSize(),$(window).on("keydown",keydownObserver),self.status="resizing"})),self.el.on("clayfy-resizeend",(function(){$(window).off("keydown",keydownObserver),self.status="ready"})),self.el.on("clayfy-dragstart",(function(e){e.stopPropagation(),self.initSize=self.getSize(),self.status="dragging"})),self.el.on("clayfy-drop",(function(e){e.stopPropagation(),self.status="ready"})),self.el.on("clayfy-resize clayfy-drag",self.updateHandlersPosition),$(window).on("resize",self.updateHandlersPosition),self.el.on("clayfy-dragstart",(function(e){e.stopPropagation(),$(window).on("keydown",keydownObserver)})),self.el.on("clayfy-drop",(function(e){e.stopPropagation(),$(window).off("keydown",keydownObserver)}));var elAndHandlers=self.el;$.each(self.handlers,(function(i,handler){self.hideHandlers(),elAndHandlers=elAndHandlers.add(handler.el)})),elAndHandlers.on("mouseover",(function(){timeout&&clearTimeout(timeout),self.showHandlers()})),elAndHandlers.on("mouseout",(function(){timeout=setTimeout(self.hideHandlers,20)})),self.el.on("clayfy-resizeend clayfy-drop",(function(e){e.stopPropagation(),self.el.parent().find(":hover").length||self.touchableDevice||(insideBox=!1,self.el.trigger("mouseout"))})),self.touchableDevice&&(elAndHandlers.on("touchstart",(function(){timeout&&clearTimeout(timeout),self.showHandlers(),timeout=setTimeout(self.hideHandlers,4e3)})),self.el.on("clayfy-resizeend clayfy-drop",(function(){self.el.trigger("click")})))},keydownObserver=function(e){27===e.keyCode&&self.cancel()},createNodes=function(){var posibles=["top left","top right","bottom left","bottom right","left","right","top","bottom"];self.touchableDevice&&(posibles=["bottom right"]),"static"===self.el.css("position")&&self.el.css("position","relative"),self.cssPosition=self.el.css("position");var draggableOptions={container:self.settings.container,not:".clayfy-handler",escape:!1,droppable:self.settings.droppable};draggableOptions=$.extend(!0,{},self.settings,draggableOptions),self.settings.move&&"relative"!==self.cssPosition||(draggableOptions.move=!1),self.draggable=new Draggable(self.el,draggableOptions);for(var i=0;i<posibles.length;i++){var positions=posibles[i].split(" "),isInOptions=!0;for(var k in positions)self.settings.hasOwnProperty(positions[k])&&self.settings[positions[k]]||(isInOptions=!1);isInOptions&&self.handlers.push(new ResizableHandler(posibles[i],self))}self.touchableDevice&&self.el.addClass("clayfy-touch-device")};this.getSize=function(){self.parent=self.el.offsetParent();var parent=self.parent,pos=self.el.position(),values;return{width:self.el.width(),height:self.el.height(),left:pos.left+parent.scrollLeft(),top:pos.top+parent.scrollTop(),outerWidth:self.el.outerWidth(),outerHeight:self.el.outerHeight()}},this.getNewSize=function(){var height=self.el.outerHeight(),width=self.el.outerWidth(),pos=self.el.position(),left=pos.left+self.parent.scrollLeft(),top=pos.top+self.parent.scrollTop();return{outerWidth:width,outerHeight:height,top:top,left:left,right:left+width,bottom:top+height,width:self.el.width(),height:self.el.height()}},this.resize={left:function(){self.el.width(self.actualSize.width-$.clayfy.dX),"relative"!==self.cssPosition&&self.el.css({left:self.actualSize.left+$.clayfy.dX})},top:function(){self.el.height(self.actualSize.height-$.clayfy.dY),"relative"!==self.cssPosition&&self.el.css({top:self.actualSize.top+$.clayfy.dY})},bottom:function(){self.el.height(self.actualSize.height+$.clayfy.dY)},right:function(){self.el.width(self.actualSize.width+$.clayfy.dX)}},this.hideHandlers=function(){"ready"===self.status&&($.each(self.handlers,(function(i,handler){handler.el.css("display","none")})),insideBox=!1)},this.showHandlers=function(){insideBox||"ready"!==self.status&&!self.touchableDevice||($.each(self.handlers,(function(i,handler){handler.el.css("display","block")})),insideBox=!0,self.updateHandlersPosition())},this.updateHandlersPosition=function(){self.newSize=self.getNewSize(),$.each(self.handlers,(function(i,handler){handler.updatePosition()}))},this.cancel=function(){console.log("cancelled"),self.status="ready",self.hideHandlers(),self.status="canceling",$("body").trigger("mouseup");var initSize="relative"!==self.cssPosition?self.initSize:{width:self.initSize.width,height:self.initSize.height};self.el.animate(initSize,100,(function(){self.status="ready",self.el.is(":hover")&&self.showHandlers(),self.el.trigger("clayfy-cancel")}))},init()}function ResizableHandler(position,resizable){this.el=$("<div>",{class:"clayfy-handler clayfy-"+position,style:"position: absolute"}),this.resizable=resizable,this.position=position,this.draggable;var self=this,shiftKeyTriggered=!1,init=function(){resizable.settings.className&&self.el.addClass(resizable.settings.className),self.updatePosition(),self.resizable.el.after(self.el),self.draggable=new Draggable(self.el,{move:!1,container:resizable.draggable.container,scroll:!1,escape:!1}),self.draggable.el.on("clayfy-drop",(function(e){resizable.el.trigger("clayfy-resizeend"),resizable.settings.callbacks.resizeend()})),self.draggable.el.on("clayfy-dragstart",(function(e){e.stopPropagation(),self.resizable.preserveAspectRatio||(self.resizable.originalSize=self.resizable.getSize()),resizable.el.trigger("clayfy-beforeresize"),self.setBounderies(),resizable.el.trigger("clayfy-resizestart"),resizable.settings.callbacks.resizestart(),shiftKeyTriggered=!1})),self.draggable.el.on("clayfy-drag",(function(e){e.shiftKey&&!resizable.preserveAspectRatio&&(resizable.shiftKey=!0),e.shiftKey||(resizable.shiftKey=!1),!shiftKeyTriggered||e.shiftKey||resizable.preserveAspectRatio||(console.log("Desactivate: preserve aspect ratio"),self.draggable.bounderies=self.originalBounderies,shiftKeyTriggered=!1),shiftKeyTriggered||!e.shiftKey||resizable.preserveAspectRatio||(console.log("Activate: preserve aspect ratio"),self.draggable.bounderies=self.aspectRatioBounderies,shiftKeyTriggered=!0),resizable.preserveAspectRatio&&!resizable.shiftKey&&(self.draggable.bounderies=self.aspectRatioBounderies)})),position.indexOf("left")>-1&&self.draggable.el.on("clayfy-drag",(function(e){(resizable.preserveAspectRatio||resizable.shiftKey)&&(self.fixDeltas(),"left"===position&&resizable.resize.top()),resizable.resize.left()})),position.indexOf("top")>-1&&self.draggable.el.on("clayfy-drag",(function(e){(resizable.preserveAspectRatio||resizable.shiftKey)&&(self.fixDeltas(),"top"===position&&resizable.resize.left()),resizable.resize.top()})),position.indexOf("right")>-1&&self.draggable.el.on("clayfy-drag",(function(e){(resizable.preserveAspectRatio||resizable.shiftKey)&&(self.fixDeltas(),"right"===position&&resizable.resize.bottom()),resizable.resize.right()})),position.indexOf("bottom")>-1&&self.draggable.el.on("clayfy-drag",(function(e){(resizable.preserveAspectRatio||resizable.shiftKey)&&(self.fixDeltas(),"bottom"===position&&resizable.resize.right()),resizable.resize.bottom()})),self.draggable.el.on("clayfy-drag",(function(e){resizable.el.trigger("clayfy-resize"),resizable.settings.callbacks.resize()})),self.resizable.touchableDevice&&self.el.addClass("clayfy-touch-device")};this.updatePosition=function(){var s=resizable.newSize;switch(self.position){case"left":self.el.css({width:5,left:s.left,top:s.top,height:s.outerHeight});break;case"right":self.el.css({width:5,left:s.right-5,top:s.top,height:s.outerHeight});break;case"top":self.el.css({height:5,left:s.left,top:s.top,width:s.outerWidth});break;case"bottom":self.el.css({height:5,left:s.left,top:s.bottom-5,width:s.outerWidth});break;case"top left":self.el.css({width:8,height:8,left:s.left,top:s.top});break;case"top right":self.el.css({width:8,height:8,left:s.right-8,top:s.top});break;case"bottom left":self.el.css({width:8,height:8,left:s.left,top:s.bottom-8});break;case"bottom right":self.resizable.touchableDevice?self.el.css({width:18,height:18,left:s.right-20,top:s.bottom-20}):self.el.css({width:8,height:8,left:s.right-8,top:s.bottom-8})}},this.setBounderies=function(bounderies){var b=bounderies||[1e5,1e5,1e5,1e5],p=[],size,s,ratio,cBounderies;self.resizable.actualSize=self.resizable.getSize(),size=self.resizable.actualSize,s=self.resizable.settings,ratio=self.resizable.originalSize.width/self.resizable.originalSize.height,(cBounderies=self.draggable.getContainerBounderies())||(cBounderies={top:1e13,right:1e13,bottom:1e13,left:1e13});for(var i=0,j=s.maxSize.length;i<j;i++)null===s.maxSize[i]&&(s.maxSize[i]=1e13);var inner=$.clayfy.getInner(self.draggable.el);"left"!==self.position&&"top"!==self.position&&"top left"!==self.position||(b[1]=size.outerWidth-s.minSize[0],b[3]=s.maxSize[0]-size.outerWidth,b[2]=size.outerHeight-s.minSize[1],b[0]=s.maxSize[1]-size.outerHeight,self.draggable.settings.bounderies=b,p[3]=Math.min(cBounderies.left,b[3],cBounderies.top*ratio,b[0]*ratio),p[0]=Math.min(cBounderies.top,b[0],cBounderies.left/ratio,b[3]/ratio),p[1]=Math.min(cBounderies.right,b[1],cBounderies.bottom*ratio+b[2],b[2]*ratio),p[2]=Math.min(cBounderies.bottom,b[2],cBounderies.right/ratio+b[1],b[1]/ratio)),"right"!==self.position&&"bottom"!==self.position&&"bottom right"!==self.position||(b[3]=size.outerWidth-s.minSize[0],b[1]=s.maxSize[0]-size.outerWidth,b[0]=size.outerHeight-s.minSize[1],b[2]=s.maxSize[1]-size.outerHeight,self.draggable.settings.bounderies=b,p[1]=Math.min(cBounderies.right,b[1],cBounderies.bottom*ratio,b[2]*ratio),p[2]=Math.min(cBounderies.bottom,b[2],cBounderies.right/ratio,b[1]/ratio),p[3]=Math.min(cBounderies.left,b[3],cBounderies.top*ratio+b[0],b[0]*ratio),p[0]=Math.min(cBounderies.top,b[0],cBounderies.left/ratio+b[3],b[3]/ratio)),"bottom left"===self.position&&(b[0]=size.outerHeight-s.minSize[1],b[1]=size.outerWidth-s.minSize[0],b[2]=s.maxSize[1]-size.outerHeight,b[3]=s.maxSize[0]-size.outerWidth,self.draggable.settings.bounderies=b,p[3]=parseInt(Math.min(cBounderies.left,b[3],cBounderies.bottom*ratio,b[2]*ratio)),p[2]=parseInt(Math.min(cBounderies.bottom,b[2],cBounderies.left/ratio,b[3]/ratio)),p[0]=parseInt(Math.min(cBounderies.top,b[0],cBounderies.right/ratio+b[1],b[1]/ratio)),p[1]=parseInt(Math.min(cBounderies.right,b[1],cBounderies.top*ratio+b[0],b[0]*ratio))),"top right"===self.position&&(b[0]=s.maxSize[1]-size.outerHeight,b[1]=s.maxSize[0]-size.outerWidth,b[2]=size.outerHeight-s.minSize[1],b[3]=size.outerWidth-s.minSize[0],self.draggable.settings.bounderies=b,p[0]=parseInt(Math.min(cBounderies.top,b[0],cBounderies.right/ratio,b[1]/ratio)),p[1]=parseInt(Math.min(cBounderies.right,b[1],cBounderies.top*ratio,b[0]*ratio)),p[3]=parseInt(Math.min(cBounderies.left,b[3],cBounderies.bottom*ratio+b[2],b[2]*ratio)),p[2]=parseInt(Math.min(cBounderies.bottom,b[2],cBounderies.left/ratio+b[3],b[3]/ratio))),self.originalBounderies={top:-b[0],right:b[1],bottom:b[2],left:-b[3]},self.aspectRatioBounderies={top:-p[0],right:p[1],bottom:p[2],left:-p[3]},self.draggable.bounderies=self.resizable.preserveAspectRatio?self.aspectRatioBounderies:self.originalBounderies},this.fixDeltas=function(){var d=$.clayfy;if(self.resizable.preserveAspectRatio)var ratio=self.resizable.originalSize.width/self.resizable.originalSize.height;if(!self.resizable.preserveAspectRatio&&self.resizable.shiftKey)var ratio=self.resizable.actualSize.width/self.resizable.actualSize.height;(self.resizable.preserveAspectRatio||self.resizable.shiftKey)&&("right"===self.position&&(d.dY=d.dX/ratio),"bottom"===self.position&&(d.dX=d.dY*ratio),"left"===self.position&&(d.dY=d.dX/ratio),"top"===self.position&&(d.dX=d.dY*ratio),"top left"===self.position&&(d.dY=d.dX/ratio),"top right"===self.position&&(d.dY=-d.dX/ratio),"bottom left"===self.position&&(d.dY=-d.dX/ratio),"bottom right"===self.position&&(d.dY=d.dX/ratio))},init()}function Sortable(el,options){this.el=el instanceof $?el:$(el),this.draggableBox,this.dropArea=$("<div>",{class:"clayfy-sort-droparea"}),this.draggable,this.droppable,this.droppableParent,this.index,this.indexRelative,this.parent,this.settings=$.extend(!0,{},$.clayfy.settings,options);var self=this,forceCancel,init=function(){setDroppable(),setDroppableParent(),setContext(),self.el.on("mousedown touchstart",(function(e){"mousedown"===e.type&&1!==e.which||(beforeDragstart(),self.draggableBox.trigger($.Event(e.type,e)))}));var draggableOptions=$.extend(!0,{},self.settings,{droppable:self.droppable,escape:!1,dropoutside:!0});self.draggable=new Draggable(self.draggableBox,draggableOptions),self.draggableBox.on("clayfy-drop",drop),self.draggableBox.on("clayfy-dropoutside",(function(e){return!1})),self.draggableBox.on("clayfy-dragenter",dragenter),self.draggableBox.on("clayfy-dragstart",(function(){var helper;self.draggable.resetDroppable(self.droppable),$(".clayfy-sort-helper").each((function(){var $this=$(this);$this.parent().is(self.droppableParent)&&self.draggable.addDroppable($this)}))})),self.draggableBox.on("clayfy-dragstart",(function(e){e.stopPropagation(),$(window).on("keydown",keydownObserver)})),self.draggableBox.on("clayfy-drop",(function(){$(window).off("keydown",keydownObserver)}))},keydownObserver=function(e){27===e.keyCode&&self.cancel()},setContext=function(){self.draggableBox=self.el.clone(),self.draggableBox.css({position:"absolute",width:"100%",height:"100%"}).addClass("clayfy-sort-dragging");var parent=self.el.parent();"static"===parent.css("position")&&parent.css("position","relative")},beforeDragstart=function(){setDroppable(),setDroppableParent(),self.index=self.droppable.index(self.el),self.parent=self.el.parent(),self.indexRelative=self.parent.find(self.droppable).index(self.el),self.draggableBox.css({width:self.el.outerWidth(),height:self.el.outerHeight(),top:self.el.position().top,left:self.el.position().left}),updateDropArea(),self.draggableBox.appendTo(self.parent),self.el.css({visibility:"hidden"})},updateDropArea=function(){self.dropArea.appendTo(self.el.parent()),self.dropArea.css({position:"absolute",width:self.el.outerWidth(),height:self.el.outerHeight(),top:self.el.position().top+parseInt(self.el.css("margin-top"))-parseInt(self.dropArea.css("border-top-width")),left:self.el.position().left+parseInt(self.el.css("margin-left"))-parseInt(self.dropArea.css("border-left-width"))})},returnToOriginalPlace=function(e){var droppableByParent=self.parent.find(self.droppable);if(self.parent.is($(self.droppedTarget).parent())){var elIndex=droppableByParent.index(self.el);self.indexRelative<elIndex?droppableByParent.eq(self.indexRelative).before(self.el):droppableByParent.eq(self.indexRelative).after(self.el)}else droppableByParent.length?droppableByParent.eq(self.indexRelative).before(self.el):self.parent.append(self.el);updateDropArea()},drop=function(e){setDroppable(),(!1===self.el.triggerHandler("validateChange")||!self.parent.is($(self.droppedTarget).parent())&&!self.settings.export||forceCancel)&&returnToOriginalPlace();var newParentOffset=self.dropArea.parent().offset(),oldParentOffset=self.draggableBox.parent().offset(),posX=self.el.position().left+(newParentOffset.left-oldParentOffset.left),posY=self.el.position().top+(newParentOffset.top-oldParentOffset.top);return self.draggableBox.animate({top:posY,left:posX},200,(function(){self.dropArea.detach(),self.el[0].style.visibility="",self.draggableBox.detach(),setDroppable();var elIndex=self.droppable.index(self.el);elIndex!=self.index&&(self.index=elIndex,self.el.trigger($.Event("clayfy-changeorder",{index:self.index,order:self.droppable}))),self.el.parent().find(".clayfy-sort-helper").remove()})),forceCancel=!1,!1},dragenter=function(e){if(!self.el.is(e.target)){setDroppable();var targetIndex=self.droppable.index(e.target),elIndex=self.droppable.index(self.el);self.droppedTarget=e.target,targetIndex>elIndex?$(e.target).after(self.el):$(e.target).before(self.el),updateDropArea(),self.draggable.updateDropArea(),self.parent.find(self.droppable).length<2?self.parent.find(".clayfy-sort-helper").length||self.parent.append('<div class="clayfy-sort-helper" style="position: absolute; width: 100%; height: 100%; top: 0; left:0"></div>'):self.parent.find(".clayfy-sort-helper").remove(),$(".clayfy-sort-helper").each((function(){var $this=$(this);$this.parent().is(self.droppableParent)&&self.draggable.addDroppable($this)}))}},setDroppable=function(){self.settings.siblings?self.droppable=self.settings.siblings instanceof $?self.settings.siblings:$(self.settings.siblings):self.droppable=self.el.siblings().andSelf()},setDroppableParent=function(){self.droppableParent||(self.droppableParent=self.el.parent()),self.droppable.each((function(){self.droppableParent=self.droppableParent.add($(this).parent())}))};this.cancel=function(){forceCancel=!0,$("body").trigger("mouseup")},init()}$.clayfy={dX:0,dY:0,container:function(element,values){return new DraggableContainer(element,values)},settings:{type:"draggable",bounderies:[1e7,1e7,1e7,1e7],container:"",moveX:!0,moveY:!0,move:!0,not:"",ghost:!1,coverScreen:!0,scrollable:"",droppable:"",fit:!0,dropoutside:!1,migrate:!1,overflow:!1,escape:!0,propagate:!0,preserveAspectRatio:!1,maxSize:[500,200],minSize:[100,50],left:!0,top:!0,right:!0,bottom:!0,className:"",siblings:"",export:!0,dragstart:function(e){},drag:function(e){},drop:function(e){}},getInner:function(element){var el=element instanceof $?element:$(element),stylePos,helper,helperWr,innerWidth,innerHeight,borderTop,borderLeft;return el.length?(stylePos=el[0].style.position,"static"===el.css("position")&&el.css({position:"relative"}),helperWr=$("<div>",{style:"position:absolute;top:0;left:0;bottom:0;right:0"}),helper=$("<div>",{style:"position:absolute;top:0;left:0;width:100%;height:100%"}),helperWr.append(helper),el.append(helperWr),innerWidth=helper.width(),innerHeight=helper.height(),helperWr.remove(),el[0].style.position=stylePos,{innerWidth:innerWidth,innerHeight:innerHeight}):{width:0,height:0}}};var pluginName="clayfy",Plugin;$.fn.clayfy=function(options){var args=arguments;if(void 0===options||"object"==typeof options){var type=$.clayfy.settings.type;switch(void 0!==options&&void 0!==options.type&&(type=options.type),type){case"draggable":Plugin=Draggable;break;case"resizable":Plugin=Resizable;break;case"sortable":Plugin=Sortable}return this.each((function(){$.data(this,"clayfy")||$.data(this,"clayfy",new Plugin(this,options))}))}if("string"==typeof options&&"_"!==options[0]&&"init"!==options){if("instance"===options)return this.length?$.data(this[0],"clayfy"):null;if(0==Array.prototype.slice.call(args,1).length&&-1!=$.inArray(options,$.fn.clayfy.getters)){var instance=$.data(this[0],"clayfy");return instance[options].apply(instance,Array.prototype.slice.call(args,1))}return this.each((function(){var instance=$.data(this,"clayfy");"function"==typeof instance[options]&&instance[options].apply(instance,Array.prototype.slice.call(args,1))}))}},$.fn.clayfy.getters=["getPosition"]}(jQuery),isTouchDevice=function(){return"ontouchstart"in window||navigator.maxTouchPoints};