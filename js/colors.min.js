!function($,undefined){"use strict";$.fn.primaryColor=function(opts){function _getContext(){return document.createElement("canvas").getContext("2d")}function _onload(img_obj,$target){var context=_getContext();context.drawImage(img_obj,0,0);for(var image_data=context.getImageData(0,0,img_obj.width,img_obj.height),pixel_length=image_data.data.length,data=image_data.data,colors={},primary_color={rgb:"",count:0},px=0;px<pixel_length;px+=4*opts.skip){var rgb=[data[px],data[px+1],data[px+2]].join(",");~$.inArray(rgb,opts.exclude)||(rgb in colors?colors[rgb]++:colors[rgb]=1);var count=colors[rgb];count>primary_color.count&&(primary_color.rgb=rgb,primary_color.count=count)}$target.attr("data-primary-color",primary_color.rgb),"function"==typeof opts.callback&&opts.callback.call($target[0],primary_color.rgb)}return opts=$.extend({skip:5,exclude:["0,0,0"],callback:null},opts),this.each((function(){var $self=$(this),image=new Image,color=$self.attr("data-primary-color");if(color)return"function"==typeof opts.callback&&opts.callback.call($self[0],color),!0;$(image).on("load",(function(e){_onload(this,$self)})),image.src=this.src||""})),this}}(jQuery);
